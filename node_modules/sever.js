var mysql      = require('mysql');
// create a simple  connection to database
var connection = mysql.createConnection({
  host     : 'localhost',
  user     : 'root',
  password : '',
  database : 'resto'
});


//test conection
connection.connect(function(err){
if(!err) {
    console.log("Database is connected!! ... ");    
} else {
    console.log("Error connecting database ...", err);    
}
});


//create a cache of database connection for use it many times
var pool =  mysql.createPool({
    connectionLimit : 100, //important
    host     : 'localhost',
    user     : 'root',
    password : '',
    database : 'resto',
    debug    :  false
});

//test pool
function handle_database(req,res) {
    
    pool.getConnection(function(err,connection){
        if (err) {
          res.json({"code" : 100, "status" : "Error in connection database"});
          return;
        }   

        console.log('connected as id ' + connection.threadId);
        

        connection.on('error', function(err) {      
              res.json({"code" : 100, "status" : "Error in connection database"});
              return;     
        });//conection.On

  });//getConnection
}//function



exports.connection = connection;
exports.handle_database = handle_database;
exports.pool = pool;